<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Copywriting</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .test-container { background: #f5f5f5; padding: 20px; border-radius: 10px; margin: 20px 0; }
        .result { background: #e8f5e8; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .error { background: #ffe8e8; padding: 15px; border-radius: 5px; margin: 10px 0; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .loading { opacity: 0.6; pointer-events: none; }
    </style>
</head>
<body>
    <h1>üß™ Test de Copywriting con Deepseek</h1>
    
    <div class="test-container">
        <h3>Configuraci√≥n del Test</h3>
        <p><strong>Red Social:</strong> Instagram</p>
        <p><strong>Palabra clave:</strong> marketing digital</p>
        <p><strong>Tipo de copy:</strong> Informativo o educativo</p>
        <p><strong>Idioma:</strong> espa√±ol</p>
        
        <button onclick="testCopywriting()" id="testBtn">üöÄ Ejecutar Test</button>
        
        <div style="margin-top: 15px; padding: 10px; background: #e8f4f8; border-radius: 5px;">
            <p><strong>üìç Endpoints disponibles:</strong></p>
            <p>‚Ä¢ Firebase: https://brain-storm-8f0d8.web.app</p>
            <p>‚Ä¢ GitHub Pages: https://gefigueroaw.github.io/lluvia-de-ideas/</p>
        </div>
    </div>
    
    <div id="results"></div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getAuth, signInAnonymously } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
        import { getFunctions, httpsCallable } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-functions.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAR-VGN8VGu8K1VJ2K-FdGXQY1wUJMF6Nw",
            authDomain: "brain-storm-8f0d8.firebaseapp.com",
            projectId: "brain-storm-8f0d8",
            storageBucket: "brain-storm-8f0d8.firebasestorage.app",
            messagingSenderId: "971421776652",
            appId: "1:971421776652:web:3f24036088fbc7f15cd8aa"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const functions = getFunctions(app);

        window.testCopywriting = async function() {
            const button = document.getElementById('testBtn');
            const resultsDiv = document.getElementById('results');
            
            button.textContent = '‚è≥ Ejecutando...';
            button.classList.add('loading');
            resultsDiv.innerHTML = '';

            try {
                // Autenticar usuario an√≥nimo
                await signInAnonymously(auth);
                console.log('‚úÖ Usuario autenticado');

                // Par√°metros del test
                const params = {
                    generationMode: 'single',
                    socialMedia: 'Instagram',
                    keyword: 'marketing digital',
                    copyType: 'Informativo o educativo',
                    language: 'espa√±ol'
                };

                console.log('üì§ Enviando request:', params);

                // Llamar a la funci√≥n
                const api = httpsCallable(functions, 'api');
                const result = await api(params);

                console.log('üì• Respuesta recibida:', result.data);

                // Mostrar resultado
                if (result.data.success) {
                    resultsDiv.innerHTML = `
                        <div class="result">
                            <h3>‚úÖ ¬°Test Exitoso!</h3>
                            <p><strong>Ideas generadas:</strong> ${result.data.ideas.length}</p>
                            <h4>Contenido generado:</h4>
                            <pre>${JSON.stringify(result.data.ideas, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    throw new Error('La funci√≥n devolvi√≥ success: false');
                }

            } catch (error) {
                console.error('‚ùå Error:', error);
                resultsDiv.innerHTML = `
                    <div class="error">
                        <h3>‚ùå Error en el Test</h3>
                        <p><strong>Mensaje:</strong> ${error.message}</p>
                        <p><strong>C√≥digo:</strong> ${error.code || 'N/A'}</p>
                        <p><strong>Detalles:</strong> ${error.details || 'N/A'}</p>
                    </div>
                `;
            } finally {
                button.textContent = 'üöÄ Ejecutar Test';
                button.classList.remove('loading');
            }
        };
    </script>
</body>
</html>
